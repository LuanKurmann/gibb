import{g as b}from"./chunk-LAPNKNDT.js";import{h as f}from"./chunk-CPYGXC5A.js";var m=class o{bmTypeInstance=null;constructor(){}initializeBMType(e,t){this.bmTypeInstance=b.create(e,t)}getBMType(){return this.bmTypeInstance}calculateSubjectFinalGrade(e,t){if(!this.bmTypeInstance)return 0;let n=this.bmTypeInstance.subjects.find(r=>r.id===e);if(!n)return 0;let a=t.filter(r=>r.subjectId===e||n.type==="ida"&&(r.subjectId==="idaf"||r.subjectId==="idpa"));return n.calculateFinalGrade(a)}calculateSubjectExperienceGrade(e,t){let n=t.filter(i=>i.subjectId===e&&i.type==="individual");if(n.length===0)return 0;let a=[];for(let i=1;i<=4;i++){let s=n.filter(u=>u.semester===i);if(s.length>0){let u=s.reduce((l,c)=>l+(c.weight||1),0),d=s.reduce((l,c)=>l+c.value*(c.weight||1),0);a.push(d/u)}}if(a.length===0)return 0;let r=a.reduce((i,s)=>i+s,0)/a.length;return Math.round(r*2)/2}calculateOverallGrade(e){return this.bmTypeInstance?this.bmTypeInstance.calculateOverallGrade(e):0}calculateIDAGrade(e){let t=e.filter(i=>i.subjectId==="idaf"),n=e.filter(i=>i.subjectId==="idpa"),a=this.calculateSubjectFinalGrade("idaf",t),r=this.calculateSubjectFinalGrade("idpa",n);return a===0&&r===0?0:a===0?r:r===0?a:Math.round((a+r)/2*2)/2}calculateNaturalScienceGrade(e){if(!this.bmTypeInstance)return 0;let t=this.bmTypeInstance.subjects.find(n=>n.id==="nw");return!t||t.type!=="natural_science"?0:t.calculateFinalGrade(e)}checkPassingRequirements(e){if(!this.bmTypeInstance)return{passed:!1,issues:["Kein BM-Typ initialisiert"],overallGrade:0,insufficientGrades:0,deviationSum:0};let t=this.bmTypeInstance.subjects.filter(s=>s.type!=="idaf"&&s.type!=="idpa").map(s=>{let u=e.filter(d=>d.subjectId===s.id||s.type==="ida"&&(d.subjectId==="idaf"||d.subjectId==="idpa"));return s.calculateFinalGrade(u)}).filter(s=>s>0),n=[],a=this.calculateOverallGrade(e);a<4&&n.push(`Gesamtnote zu tief: ${a.toFixed(1)} (min. 4.0)`);let r=t.filter(s=>s<4);r.length>2&&n.push(`Zu viele ungen\xFCgende Noten: ${r.length} (max. 2)`);let i=r.reduce((s,u)=>s+(4-u),0);return i>2&&n.push(`Abweichungssumme zu hoch: ${i.toFixed(1)} (max. 2.0)`),{passed:n.length===0,issues:n,overallGrade:a,insufficientGrades:r.length,deviationSum:i}}getSubjects(){return this.bmTypeInstance?.subjects||[]}getSubjectById(e){return this.bmTypeInstance?.subjects.find(t=>t.id===e)||null}getGradesForSubject(e,t){return t.filter(n=>n.subjectId===e)}getSemesterAverages(e,t){let n=t.filter(r=>r.subjectId===e&&r.type==="individual"),a=[];for(let r=1;r<=4;r++){let i=n.filter(s=>s.semester===r);if(i.length>0){let s=i.reduce((l,c)=>l+(c.weight||1),0),u=i.reduce((l,c)=>l+c.value*(c.weight||1),0),d=Math.round(u/s*2)/2;a.push({semester:r,average:d})}}return a}validateGrade(e){let t=[];return(!e.value||e.value<1||e.value>6)&&t.push("Note muss zwischen 1.0 und 6.0 liegen"),e.subjectId||t.push("Fach muss ausgew\xE4hlt werden"),e.type||t.push("Notentyp muss angegeben werden"),e.type==="individual"&&!e.semester&&t.push("Semester muss f\xFCr individuelle Noten angegeben werden"),e.weight&&(e.weight<=0||e.weight>10)&&t.push("Gewichtung muss zwischen 0.1 und 10.0 liegen"),t}getGradeColorClass(e){return e===0?"text-gray-400":e>=4?"text-green-600":"text-red-600"}getGradeBadgeClass(e){return e===0?"bg-gray-100 text-gray-600":e>=4?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}formatGrade(e){return e>0?e.toFixed(1):"-"}static \u0275fac=function(t){return new(t||o)};static \u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
