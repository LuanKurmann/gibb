import{a as O}from"./chunk-EDTSN2CE.js";import{c as G,f as z,k as W,l as D,m as P,r as R}from"./chunk-RDPPS4E7.js";import"./chunk-LAPNKNDT.js";import{a as A}from"./chunk-DFZIMTXV.js";import{$ as b,Aa as j,Ba as V,C as h,I as d,J as i,K as n,L as x,M as _,N as c,O as u,U as B,V as a,W as m,X as M,aa as w,ba as T,m as p,n as g,o as v,p as C,pa as k,qa as I,sa as N,v as r,wa as L,x as S,xa as F,y as E}from"./chunk-CPYGXC5A.js";import"./chunk-LJ5XHLMQ.js";import{h as y}from"./chunk-FK42CRUA.js";function H(o,s){if(o&1&&(i(0,"div",15)(1,"span",16),a(2),n(),i(3,"span",17),a(4),n()()),o&2){let e=u();r(2),m(e.i18n.t("auth.username")),r(2),m(e.user==null?null:e.user.username)}}function K(o,s){if(o&1&&(i(0,"option",37),a(1),n()),o&2){let e=s.$implicit;d("value",e.id),r(),M(" ",e.name," ")}}function q(o,s){if(o&1){let e=_();i(0,"div")(1,"label",23),a(2),n(),i(3,"select",24),T("ngModelChange",function(l){p(e);let f=u();return w(f.studyMode,l)||(f.studyMode=l),g(l)}),c("ngModelChange",function(){p(e);let l=u();return g(l.onStudyModeChange())}),i(4,"option",38),a(5),n(),i(6,"option",39),a(7),n()()()}if(o&2){let e=u();r(2),m(e.i18n.t("bmGrades.studyMode")),r(),b("ngModel",e.studyMode),r(2),m(e.i18n.t("bmGrades.fulltime")),r(2),m(e.i18n.t("bmGrades.parttime"))}}function J(o,s){o&1&&(v(),i(0,"svg",43),x(1,"circle",44)(2,"path",45),n())}function Q(o,s){if(o&1){let e=_();i(0,"div",40)(1,"button",41),c("click",function(){p(e);let l=u();return g(l.checkForChangesAndSave())}),h(2,J,3,0,"svg",42),a(3),n()()}if(o&2){let e=u();r(),d("disabled",e.isSaving),r(),d("ngIf",e.isSaving),r(),M(" ",e.isSaving?"Speichern...":"Einstellungen speichern"," ")}}function X(o,s){o&1&&(v(),i(0,"svg",49),x(1,"path",50),n())}function Y(o,s){o&1&&(v(),i(0,"svg",49),x(1,"path",51),n())}function Z(o,s){if(o&1&&(i(0,"div",46)(1,"div",4),h(2,X,2,0,"svg",47)(3,Y,2,0,"svg",47),i(4,"span",48),a(5),n()()()),o&2){let e=u();B(e.saveMessageType==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"),r(2),d("ngIf",e.saveMessageType==="success"),r(),d("ngIf",e.saveMessageType==="error"),r(2),m(e.saveMessage)}}function $(o,s){if(o&1){let e=_();i(0,"div",52)(1,"div",53)(2,"div",54)(3,"h3",13),a(4),n(),i(5,"div",55)(6,"button",56),c("click",function(){p(e);let l=u();return g(l.cancelLogout())}),a(7," Cancel "),n(),i(8,"button",57),c("click",function(){p(e);let l=u();return g(l.logout())}),a(9),n()()()()()}if(o&2){let e=u();r(4),m(e.i18n.t("settings.logoutConfirm")),r(5),M(" ",e.i18n.t("settings.logout")," ")}}function ee(o,s){if(o&1){let e=_();i(0,"div",58)(1,"div",59)(2,"div",60)(3,"div",61)(4,"div",62),v(),i(5,"svg",63),x(6,"path",64),n()(),C(),i(7,"div",65)(8,"h3",13),a(9,"BM-Typ \xE4ndern"),n()()(),i(10,"div",66)(11,"p",67)(12,"strong"),a(13,"Achtung:"),n(),a(14," Wenn Sie den BM-Typ \xE4ndern, werden alle Ihre gespeicherten Tests automatisch gel\xF6scht, da sie m\xF6glicherweise nicht mehr zu den neuen F\xE4chern passen. "),n(),i(15,"p",68),a(16," M\xF6chten Sie wirklich fortfahren und alle Tests l\xF6schen? "),n()(),i(17,"div",69)(18,"button",70),c("click",function(){p(e);let l=u();return g(l.cancelBMTypeChange())}),a(19," Abbrechen "),n(),i(20,"button",57),c("click",function(){p(e);let l=u();return g(l.confirmBMTypeChange())}),a(21," Ja, Tests l\xF6schen "),n()()()()()}}var U=class o{constructor(s,e,t,l){this.supabaseService=s;this.router=e;this.i18n=t;this.testCalendarService=l}user=null;currentLanguage="en";showLogoutConfirm=!1;selectedBMType="";studyMode="fulltime";previousBMType="";isSaving=!1;saveMessage="";saveMessageType="";showBMTypeChangeConfirm=!1;pendingBMType="";pendingStudyMode="fulltime";bmTypes=[{id:"tals",name:"BM 2 Technik, Architektur, Life Sciences (TALS)",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m-g",name:"Mathematik Grundlagen",shortName:"M-G",hasExam:!0,isCore:!0},{id:"m-s",name:"Mathematik Schwerpunkt",shortName:"M-S",hasExam:!0,isCore:!0},{id:"nw",name:"Naturwissenschaften",shortName:"NW",hasExam:!0,isCore:!0,partTimeSubjects:[{id:"nw-chemie",name:"Chemie",shortName:"CH",weight:.33,semesters:[1]},{id:"nw-physik",name:"Physik",shortName:"PH",weight:.67,semesters:[1,2]}]},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"wr",name:"Wirtschaft & Recht",shortName:"WR",hasExam:!0,isCore:!0}]},{id:"wd-d",name:"BM 2 Dienstleistungen (WD-D)",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m",name:"Mathematik",shortName:"M",hasExam:!0,isCore:!0},{id:"fr",name:"Finanz- & Rechnungswesen",shortName:"FR",hasExam:!0,isCore:!0},{id:"wr",name:"Wirtschaft & Recht Schwerpunkt",shortName:"WR",hasExam:!0,isCore:!0},{id:"wr-e",name:"Wirtschaft & Recht Erg\xE4nzung",shortName:"WR-E",hasExam:!1,isCore:!1},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0}]},{id:"arte",name:"BM 2 Gestaltung & Kunst (ARTE)",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m",name:"Mathematik",shortName:"M",hasExam:!0,isCore:!0},{id:"gkk",name:"Gestaltung / Kunst / Kultur",shortName:"GKK",hasExam:!0,isCore:!0},{id:"ik",name:"Information & Kommunikation",shortName:"IK",hasExam:!0,isCore:!0},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"tu",name:"Technik & Umwelt",shortName:"TU",hasExam:!0,isCore:!0}]},{id:"gesundheit",name:"BM 2 Gesundheit & Soziales",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m",name:"Mathematik",shortName:"M",hasExam:!0,isCore:!0},{id:"sw",name:"Sozialwissenschaften",shortName:"SW",hasExam:!0,isCore:!0},{id:"nw",name:"Naturwissenschaften",shortName:"NW",hasExam:!0,isCore:!0,partTimeSubjects:[{id:"nw-chemie",name:"Chemie",shortName:"CH",weight:.33,semesters:[1]},{id:"nw-physik",name:"Physik",shortName:"PH",weight:.67,semesters:[1,2]}]},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"wr",name:"Wirtschaft & Recht",shortName:"WR",hasExam:!0,isCore:!0}]}];ngOnInit(){this.supabaseService.user$.subscribe(s=>{this.user=s}),this.i18n.currentLanguage$.subscribe(s=>{this.currentLanguage=s}),this.loadBMSettings()}changeLanguage(s){this.i18n.setLanguage(s)}confirmLogout(){this.showLogoutConfirm=!0}cancelLogout(){this.showLogoutConfirm=!1}logout(){return y(this,null,function*(){try{yield this.supabaseService.signOut(),this.router.navigate(["/auth/login"])}catch(s){console.error("Logout error:",s)}})}loadBMSettings(){return y(this,null,function*(){let s=this.supabaseService.getCurrentUser();if(s)try{let{data:e,error:t}=yield this.supabaseService.client.from("bm_settings").select("*").eq("user_id",s.id).single();e&&!t&&(this.selectedBMType=e.bm_type||"",this.studyMode=e.study_mode||"fulltime",this.previousBMType=this.selectedBMType)}catch(e){console.error("Error loading BM settings:",e)}})}onBMTypeChange(){this.selectedBMType!==this.previousBMType&&this.previousBMType&&(this.pendingBMType=this.selectedBMType,this.pendingStudyMode=this.studyMode,this.showBMTypeChangeConfirm=!0,this.selectedBMType=this.previousBMType)}onStudyModeChange(){}checkForChangesAndSave(){this.selectedBMType!==this.previousBMType&&this.previousBMType?(this.pendingBMType=this.selectedBMType,this.pendingStudyMode=this.studyMode,this.showBMTypeChangeConfirm=!0,this.selectedBMType=this.previousBMType):this.saveBMSettings()}confirmBMTypeChange(){this.selectedBMType=this.pendingBMType,this.studyMode=this.pendingStudyMode,this.showBMTypeChangeConfirm=!1,this.saveBMSettings()}cancelBMTypeChange(){this.showBMTypeChangeConfirm=!1,this.pendingBMType="",this.pendingStudyMode="fulltime"}saveBMSettings(){return y(this,null,function*(){let s=this.supabaseService.getCurrentUser();if(!s||!this.selectedBMType){this.showSaveMessage("Bitte w\xE4hlen Sie einen BM-Typ aus.","error");return}this.isSaving=!0,this.saveMessage="";try{this.selectedBMType!==this.previousBMType&&this.previousBMType&&(console.log("BM type changed from",this.previousBMType,"to",this.selectedBMType,"- deleting all tests"),yield this.deleteAllTests());let{error:e}=yield this.supabaseService.client.from("bm_settings").upsert({user_id:s.id,bm_type:this.selectedBMType,study_mode:this.studyMode},{onConflict:"user_id"});e?(console.error("Supabase error:",e),this.showSaveMessage("Fehler beim Speichern der Einstellungen.","error")):(this.previousBMType=this.selectedBMType,this.showSaveMessage("Einstellungen erfolgreich gespeichert!","success"))}catch(e){console.error("Error saving BM settings:",e),this.showSaveMessage("Fehler beim Speichern der Einstellungen.","error")}finally{this.isSaving=!1}})}deleteAllTests(){return y(this,null,function*(){let s=this.supabaseService.getCurrentUser();if(s)try{console.log("Deleting all tests for user:",s.id);let{data:e,error:t}=yield this.supabaseService.client.from("scheduled_tests").delete().eq("user_id",s.id).select();t?console.error("Error deleting tests:",t):console.log("Successfully deleted tests:",e)}catch(e){console.error("Error deleting tests:",e)}})}showSaveMessage(s,e){this.saveMessage=s,this.saveMessageType=e,setTimeout(()=>{this.saveMessage="",this.saveMessageType=""},3e3)}static \u0275fac=function(e){return new(e||o)(S(V),S(L),S(A),S(O))};static \u0275cmp=E({type:o,selectors:[["app-settings"]],decls:59,vars:20,consts:[[1,"min-h-screen","bg-gray-50"],[1,"bg-white","shadow"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","h-16"],[1,"flex","items-center"],["routerLink","/dashboard",1,"text-primary-600","hover:text-primary-500","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-xl","font-semibold","text-gray-900"],[1,"max-w-2xl","mx-auto","py-6","sm:px-6","lg:px-8"],[1,"px-4","py-6","sm:px-0"],[1,"bg-white","shadow","rounded-lg"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"text-lg","font-medium","text-gray-900"],[1,"px-6","py-4","space-y-4"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-700"],[1,"text-sm","text-gray-900"],["class","flex items-center justify-between",4,"ngIf"],[1,"text-sm","text-gray-900","font-mono"],[1,"px-6","py-4","border-t","border-gray-200"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-primary-500","focus:ring-primary-500",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["class","pt-4",4,"ngIf"],["class","mt-3 p-3 rounded-md",3,"class",4,"ngIf"],[1,"space-y-2"],["type","radio","name","language","value","en",1,"h-4","w-4","text-primary-600","focus:ring-primary-500","border-gray-300",3,"change","checked"],[1,"ml-2","text-sm","text-gray-700"],["type","radio","name","language","value","de",1,"h-4","w-4","text-primary-600","focus:ring-primary-500","border-gray-300",3,"change","checked"],[1,"w-full","flex","justify-center","py-2","px-4","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-red-600","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-red-500",3,"click"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",4,"ngIf"],[3,"value"],["value","fulltime"],["value","parttime"],[1,"pt-4"],[1,"w-full","flex","justify-center","py-2","px-4","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-primary-600","hover:bg-primary-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","animate-spin -ml-1 mr-3 h-5 w-5 text-white","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"mt-3","p-3","rounded-md"],["class","w-5 h-5 mr-2","fill","currentColor","viewBox","0 0 20 20",4,"ngIf"],[1,"text-sm","font-medium"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","mr-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50"],[1,"relative","top-20","mx-auto","p-5","border","w-96","shadow-lg","rounded-md","bg-white"],[1,"mt-3","text-center"],[1,"mt-6","flex","space-x-3"],[1,"flex-1","px-4","py-2","bg-gray-300","text-gray-700","text-sm","font-medium","rounded-md","hover:bg-gray-400","focus:outline-none","focus:ring-2","focus:ring-gray-300",3,"click"],[1,"flex-1","px-4","py-2","bg-red-600","text-white","text-sm","font-medium","rounded-md","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-red-500",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"bg-white","rounded-lg","shadow-xl","w-full","max-w-md"],[1,"p-6"],[1,"flex","items-center","mb-4"],[1,"flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-yellow-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"ml-3"],[1,"mb-6"],[1,"text-sm","text-gray-700","mb-4"],[1,"text-sm","text-gray-600"],[1,"flex","space-x-3"],[1,"flex-1","px-4","py-2","border","border-gray-300","text-gray-700","text-sm","font-medium","rounded-md","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"click"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"nav",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"a",5),v(),i(6,"svg",6),x(7,"path",7),n()(),C(),i(8,"h1",8),a(9),n()()()()(),i(10,"main",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"h2",13),a(15),n()(),i(16,"div",14)(17,"div",15)(18,"span",16),a(19),n(),i(20,"span",17),a(21),n()(),h(22,H,5,2,"div",18),i(23,"div",15)(24,"span",16),a(25,"User ID"),n(),i(26,"span",19),a(27),n()()(),i(28,"div",20)(29,"h3",21),a(30),n(),i(31,"div",22)(32,"div")(33,"label",23),a(34),n(),i(35,"select",24),T("ngModelChange",function(f){return w(t.selectedBMType,f)||(t.selectedBMType=f),f}),c("ngModelChange",function(){return t.onBMTypeChange()}),i(36,"option",25),a(37),n(),h(38,K,2,2,"option",26),n()(),h(39,q,8,4,"div",27)(40,Q,4,3,"div",28)(41,Z,6,5,"div",29),n()(),i(42,"div",20)(43,"h3",21),a(44),n(),i(45,"div",30)(46,"label",4)(47,"input",31),c("change",function(){return t.changeLanguage("en")}),n(),i(48,"span",32),a(49,"English"),n()(),i(50,"label",4)(51,"input",33),c("change",function(){return t.changeLanguage("de")}),n(),i(52,"span",32),a(53,"Deutsch"),n()()()(),i(54,"div",20)(55,"button",34),c("click",function(){return t.confirmLogout()}),a(56),n()()()()(),h(57,$,10,2,"div",35),n(),h(58,ee,22,0,"div",36)),e&2&&(r(9),m(t.i18n.t("settings.title")),r(6),m(t.i18n.t("settings.userInfo")),r(4),m(t.i18n.t("auth.email")),r(2),m(t.user==null?null:t.user.email),r(),d("ngIf",t.user==null?null:t.user.username),r(5),m(t.user==null?null:t.user.id),r(3),m(t.i18n.t("settings.bmSettings")),r(4),m(t.i18n.t("bmGrades.selectType")),r(),b("ngModel",t.selectedBMType),r(2),m(t.i18n.t("bmGrades.selectType")),r(),d("ngForOf",t.bmTypes),r(),d("ngIf",t.selectedBMType),r(),d("ngIf",t.selectedBMType),r(),d("ngIf",t.saveMessage),r(3),m(t.i18n.t("settings.language")),r(3),d("checked",t.currentLanguage==="en"),r(4),d("checked",t.currentLanguage==="de"),r(5),M(" ",t.i18n.t("settings.logout")," "),r(),d("ngIf",t.showLogoutConfirm),r(),d("ngIf",t.showBMTypeChangeConfirm))},dependencies:[N,k,I,j,F,R,D,P,W,G,z],encapsulation:2})};export{U as SettingsComponent};
