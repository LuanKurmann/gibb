import{a as z}from"./chunk-EDTSN2CE.js";import{a as N}from"./chunk-A43KML7G.js";import{a as j}from"./chunk-NZJYMUTK.js";import{g as L}from"./chunk-LAPNKNDT.js";import{a as G}from"./chunk-DFZIMTXV.js";import{Aa as D,Ba as B,C as g,I as l,J as i,K as n,L as v,O as b,R as E,U as f,V as r,W as S,X as m,Y as T,ha as M,o as p,p as u,pa as _,qa as I,sa as w,v as s,x as h,xa as k,y as C}from"./chunk-CPYGXC5A.js";import"./chunk-LJ5XHLMQ.js";import{h as x}from"./chunk-FK42CRUA.js";function H(o,t){o&1&&(i(0,"div",28)(1,"div",29),p(),i(2,"svg",30),v(3,"path",31),n(),u(),i(4,"span",32),r(5,"BM-Typ noch nicht konfiguriert"),n()(),i(6,"a",33),r(7," Jetzt konfigurieren "),n()())}function P(o,t){if(o&1&&(i(0,"div",34)(1,"div",35)(2,"div",36),r(3,"BM-Typ"),n(),i(4,"div",37),r(5),n(),i(6,"div",38),r(7),n()(),i(8,"div",39)(9,"div",40),r(10,"Gesamtnote"),n(),i(11,"div",41),r(12),n()(),i(13,"div",42)(14,"div",43),r(15," Status "),n(),i(16,"div",44),r(17),n()(),i(18,"div",45)(19,"div",46),r(20,"F\xE4cher mit Noten"),n(),i(21,"div",47),r(22),n()()()),o&2){let e=b();s(5),S(e.getBMTypeName()),s(2),S(e.getStudyModeName()),s(4),f(e.getGradeColor(e.overallGrade)),s(),m(" ",e.formatGrade(e.overallGrade)," "),s(),f(e.passingStatus.passed?"bg-green-50":"bg-red-50"),s(),f(e.passingStatus.passed?"text-green-600":"text-red-600"),s(2),f(e.passingStatus.passed?"text-green-900":"text-red-900"),s(),m(" ",e.passingStatus.passed?"Bestanden":"Nicht bestanden"," "),s(5),T(" ",e.getSubjectsWithGradesCount(),"/",e.getTotalSubjectsCount()," ")}}function U(o,t){if(o&1&&(i(0,"li"),r(1),n()),o&2){let e=t.$implicit;s(),m("\u2022 ",e)}}function O(o,t){if(o&1&&(i(0,"div",48)(1,"h4",49),r(2,"Probleme beim Bestehen:"),n(),i(3,"ul",50),g(4,U,2,1,"li",51),n()()),o&2){let e=b();s(4),l("ngForOf",e.passingStatus.issues)}}function $(o,t){if(o&1&&(i(0,"span"),r(1),n()),o&2){let e=b().$implicit;s(),m(" (",e.duration," Min.)")}}function R(o,t){if(o&1&&(i(0,"div",54)(1,"div",55)(2,"div",56)(3,"span",57),r(4),n(),i(5,"span",17),r(6),n(),i(7,"span",58),r(8),n()(),i(9,"div",59),r(10),g(11,$,2,1,"span",60),n()(),i(12,"div",61)(13,"div",62),r(14),n()()()),o&2){let e=t.$implicit,a=b(2);s(3),f(a.getTestTypeColor(e.testType)),s(),m(" ",a.formatTestType(e.testType)," "),s(2),S(e.title),s(2),m("- ",a.getSubjectName(e.subjectId)),s(2),T(" ",a.formatDate(e.scheduledDate)," um ",a.formatTime(e.scheduledDate)," "),s(),l("ngIf",e.duration),s(3),m(" ",a.getDaysUntilTest(e.scheduledDate)," ")}}function q(o,t){if(o&1&&(i(0,"div",52),g(1,R,15,9,"div",53),n()),o&2){let e=b();s(),l("ngForOf",e.upcomingTests)}}function A(o,t){o&1&&(i(0,"div",63),p(),i(1,"svg",64),v(2,"path",22),n(),u(),i(3,"p"),r(4,"Keine Tests in den n\xE4chsten 7 Tagen geplant"),n(),i(5,"a",65),r(6," Test hinzuf\xFCgen "),n()())}var F=class o{constructor(t,e,a,c){this.supabaseService=t;this.bmCalculationService=e;this.testCalendarService=a;this.i18n=c}user=null;bmSettings=null;bmTypeInstance=null;upcomingTests=[];overallGrade=0;passingStatus={passed:!1,issues:[]};ngOnInit(){this.supabaseService.user$.subscribe(t=>{this.user=t,t&&this.loadDashboardData()}),this.testCalendarService.scheduledTests$.subscribe(t=>{this.upcomingTests=this.testCalendarService.getUpcomingTests(7)})}loadDashboardData(){return x(this,null,function*(){try{yield this.loadBMSettings(),this.bmSettings&&(yield this.initializeBMType(),yield this.loadGradesAndCalculate())}catch(t){console.error("Error loading dashboard data:",t)}})}loadBMSettings(){return x(this,null,function*(){let t=yield this.supabaseService.getCurrentUser();if(!t)return;let{data:e,error:a}=yield this.supabaseService.client.from("bm_settings").select("*").eq("user_id",t.id).single();!a&&e&&(this.bmSettings={bmType:e.bm_type,studyMode:e.study_mode})})}initializeBMType(){return x(this,null,function*(){this.bmSettings&&(this.bmTypeInstance=L.create(this.bmSettings.bmType,this.bmSettings.studyMode),this.bmCalculationService.initializeBMType(this.bmSettings.bmType,this.bmSettings.studyMode))})}loadGradesAndCalculate(){return x(this,null,function*(){let t=yield this.supabaseService.getCurrentUser();if(!t)return;let{data:e}=yield this.supabaseService.client.from("grades").select("*").eq("user_id",t.id);e&&this.bmTypeInstance&&(this.overallGrade=this.bmTypeInstance.calculateOverallGrade(e),this.passingStatus=this.calculatePassingRequirements(e))})}getBMTypeName(){return this.bmTypeInstance?.name||"Nicht konfiguriert"}getStudyModeName(){return this.bmSettings?this.bmSettings.studyMode==="fulltime"?"Vollzeit":"Teilzeit":""}calculatePassingRequirements(t){let e=this.bmTypeInstance?.subjects.map(d=>{let y=t.filter(V=>V.subject_id===d.id);return d.calculateFinalGrade(y)}).filter(d=>d>0)||[],a=e.filter(d=>d<4).length,c=e.length>0?e.reduce((d,y)=>d+y,0)/e.length:0;return{passed:c>=4&&a<=2,issues:a>2?[`${a} ungen\xFCgende Noten`]:[],overallGrade:c,insufficientGrades:a}}formatGrade(t){return t>0?t.toFixed(1):"-"}getGradeColor(t){return t>=5.5?"text-green-600":t>=4?"text-blue-600":t>=3?"text-yellow-600":"text-red-600"}formatTestType(t){return this.testCalendarService.formatTestType(t)}getTestTypeColor(t){return this.testCalendarService.getTestTypeColor(t)}getSubjectName(t){if(!this.bmTypeInstance)return t;let e=this.bmTypeInstance.subjects.find(a=>a.id===t);return e?e.name:t}formatDate(t){return new Date(t).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"})}formatTime(t){return new Date(t).toLocaleTimeString("de-CH",{hour:"2-digit",minute:"2-digit"})}getSubjectsWithGradesCount(){return this.bmTypeInstance,0}getTotalSubjectsCount(){return this.bmTypeInstance?.subjects?.length||0}getDaysUntilTest(t){let e=new Date(t),a=new Date,c=e.getTime()-a.getTime(),d=Math.ceil(c/(1e3*60*60*24));return d===0?"Heute":d===1?"Morgen":d>1?`in ${d} Tagen`:"\xDCberf\xE4llig"}static \u0275fac=function(e){return new(e||o)(h(B),h(N),h(z),h(G))};static \u0275cmp=C({type:o,selectors:[["app-dashboard"]],decls:49,vars:6,consts:[["noUpcomingTests",""],[3,"title"],[1,"space-y-6"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-xl","font-semibold","mb-4"],["class","bg-yellow-50 border border-yellow-200 rounded-lg p-4",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-4 gap-4",4,"ngIf"],["class","mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",4,"ngIf"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold"],["routerLink","/test-calendar",1,"text-blue-600","hover:text-blue-800","text-sm","font-medium"],["class","space-y-3",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["routerLink","/bm-grades",1,"flex","items-center","p-4","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"bg-blue-100","p-3","rounded-lg","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"font-medium"],[1,"text-sm","text-gray-600"],["routerLink","/test-calendar",1,"flex","items-center","p-4","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"bg-green-100","p-3","rounded-lg","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],["routerLink","/settings",1,"flex","items-center","p-4","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"bg-purple-100","p-3","rounded-lg","mr-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-purple-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"bg-yellow-50","border","border-yellow-200","rounded-lg","p-4"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-yellow-600","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-yellow-800"],["routerLink","/settings",1,"inline-block","mt-2","text-yellow-700","hover:text-yellow-900","underline"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"bg-blue-50","p-4","rounded-lg"],[1,"text-sm","text-blue-600","font-medium"],[1,"text-lg","font-bold","text-blue-900"],[1,"text-sm","text-blue-700"],[1,"bg-purple-50","p-4","rounded-lg"],[1,"text-sm","text-purple-600","font-medium"],[1,"text-2xl","font-bold"],[1,"p-4","rounded-lg"],[1,"text-sm","font-medium"],[1,"text-lg","font-bold"],[1,"bg-gray-50","p-4","rounded-lg"],[1,"text-sm","text-gray-600","font-medium"],[1,"text-2xl","font-bold","text-gray-900"],[1,"mt-4","p-4","bg-red-50","border","border-red-200","rounded-lg"],[1,"font-medium","text-red-800","mb-2"],[1,"text-sm","text-red-700","space-y-1"],[4,"ngFor","ngForOf"],[1,"space-y-3"],["class","flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-3","border","border-gray-200","rounded-lg","hover:bg-gray-50"],[1,"flex-1"],[1,"flex","items-center","space-x-2"],[1,"px-2","py-1","text-xs","rounded-full"],[1,"text-gray-500"],[1,"text-sm","text-gray-600","mt-1"],[4,"ngIf"],[1,"text-right"],[1,"text-sm","text-gray-500"],[1,"text-center","py-8","text-gray-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-3","text-gray-300"],["routerLink","/test-calendar",1,"inline-block","mt-2","text-blue-600","hover:text-blue-800","text-sm"]],template:function(e,a){if(e&1&&(i(0,"app-page-layout",1)(1,"div",2)(2,"div",3)(3,"h2",4),r(4,"BM Status \xDCbersicht"),n(),g(5,H,8,0,"div",5)(6,P,23,14,"div",6)(7,O,5,1,"div",7),n(),i(8,"div",3)(9,"div",8)(10,"h2",9),r(11,"N\xE4chste Tests (7 Tage)"),n(),i(12,"a",10),r(13," Alle Tests anzeigen \u2192 "),n()(),g(14,q,2,1,"div",11)(15,A,7,0,"ng-template",null,0,M),n(),i(17,"div",3)(18,"h2",4),r(19,"Schnellzugriff"),n(),i(20,"div",12)(21,"a",13)(22,"div",14),p(),i(23,"svg",15),v(24,"path",16),n()(),u(),i(25,"div")(26,"div",17),r(27,"Noten verwalten"),n(),i(28,"div",18),r(29,"Noten eintragen und anzeigen"),n()()(),i(30,"a",19)(31,"div",20),p(),i(32,"svg",21),v(33,"path",22),n()(),u(),i(34,"div")(35,"div",17),r(36,"Test-Kalender"),n(),i(37,"div",18),r(38,"Tests planen und verwalten"),n()()(),i(39,"a",23)(40,"div",24),p(),i(41,"svg",25),v(42,"path",26)(43,"path",27),n()(),u(),i(44,"div")(45,"div",17),r(46,"Einstellungen"),n(),i(47,"div",18),r(48,"BM-Typ und Profil konfigurieren"),n()()()()()()()),e&2){let c=E(16);l("title",a.i18n.t("navigation.dashboard")),s(5),l("ngIf",!a.bmSettings),s(),l("ngIf",a.bmSettings),s(),l("ngIf",a.bmSettings&&!a.passingStatus.passed&&a.passingStatus.issues.length>0),s(7),l("ngIf",a.upcomingTests.length>0)("ngIfElse",c)}},dependencies:[w,_,I,D,k,j],encapsulation:2})};export{F as DashboardComponent};
