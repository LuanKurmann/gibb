import{a as U,c as H,d as K,e as Y,f as J,g as Q,h as X,k as Z,l as $,m as ee,n as te,o as ie,p as ne,r as re}from"./chunk-RDPPS4E7.js";import{a as oe}from"./chunk-NZJYMUTK.js";import{a as ae}from"./chunk-DFZIMTXV.js";import{$ as _,Ba as q,C as b,D,I as m,J as n,K as r,L as S,M as C,N as y,O as c,U as w,V as s,W as u,X as x,Y as P,Z as N,_ as F,aa as h,ba as v,ca as I,ea as W,fa as T,ga as k,m as p,n as g,o as f,p as E,pa as A,qa as B,ra as O,sa as R,ua as z,v as t,wa as L,x as G,y as V}from"./chunk-CPYGXC5A.js";import"./chunk-LJ5XHLMQ.js";import{h as j}from"./chunk-FK42CRUA.js";var se=()=>[1,2,3,4];function le(a,o){if(a&1&&(n(0,"div",22)(1,"div",23),f(),n(2,"svg",24),S(3,"path",25),r(),E(),n(4,"span",26),s(5),r()(),n(6,"p",27),s(7),r()()),a&2){let e=c(2);t(5),u(e.i18n.t("bmGrades.specialSubject")),t(2),u(e.i18n.t("bmGrades.specialSubjectInfo"))}}function ce(a,o){if(a&1&&(n(0,"div",17)(1,"div",18),s(2),r(),n(3,"div",19),s(4),r()()),a&2){let e=c(2);t(),w(e.getGradeColorClass(e.calculateExperienceGrade())),t(),x(" ",e.calculateExperienceGrade()>0?e.calculateExperienceGrade().toFixed(1):"-"," "),t(2),u(e.i18n.t("bmGrades.experienceGrade"))}}function me(a,o){if(a&1&&(n(0,"div",17)(1,"div",18),s(2),r(),n(3,"div",19),s(4),r()()),a&2){let e,d,i=c(2);t(),w(i.getGradeColorClass(((e=i.getExamGrade())==null?null:e.value)||0)),t(),x(" ",((d=i.getExamGrade())==null||d.value==null?null:d.value.toFixed(1))||"-"," "),t(2),u(i.i18n.t("bmGrades.examGrade"))}}function ue(a,o){if(a&1&&(n(0,"div",38),s(1),r()),a&2){let e=c(4);t(),x(" ",e.i18n.t("bmGrades.noGrades")," ")}}function pe(a,o){if(a&1){let e=C();n(0,"div",41)(1,"div",42)(2,"div",43),s(3),r(),n(4,"div",44),s(5),T(6,"date"),r()(),n(7,"div",45)(8,"span",46),s(9),r(),n(10,"button",47),y("click",function(){let i=p(e).$implicit,l=c(5);return g(l.deleteGrade(i.id))}),f(),n(11,"svg",48),S(12,"path",49),r()()()()}if(a&2){let e=o.$implicit,d=c(5);t(3),u(e.name||d.i18n.t("bmGrades.unnamed")),t(2),N(" ",k(6,7,e.date_taken,"dd.MM.yyyy")," \u2022 ",d.i18n.t("bmGrades.weight"),": ",e.weight||1," "),t(3),w(d.getGradeColorClass(e.value)),t(),x(" ",e.value.toFixed(1)," ")}}function ge(a,o){if(a&1&&(n(0,"div",39),b(1,pe,13,10,"div",40),r()),a&2){let e=c().$implicit,d=c(3);t(),m("ngForOf",d.getGradesBySemester(e))}}function xe(a,o){if(a&1&&(n(0,"div",30)(1,"div",31)(2,"div",32)(3,"h4",33),s(4),r(),n(5,"span",34),s(6),r()()(),n(7,"div",35),b(8,ue,2,1,"div",36)(9,ge,2,1,"div",37),r()()),a&2){let e=o.$implicit,d=c(3);t(4),P("",e,". ",d.i18n.t("bmGrades.semester")),t(),w(d.getGradeColorClass(d.calculateSemesterAverage(e))),t(),x(" \u2300 ",d.calculateSemesterAverage(e)>0?d.calculateSemesterAverage(e).toFixed(1):"-"," "),t(2),m("ngIf",d.getGradesBySemester(e).length===0),t(),m("ngIf",d.getGradesBySemester(e).length>0)}}function be(a,o){a&1&&(n(0,"div",28),b(1,xe,10,7,"div",29),r()),a&2&&(t(),m("ngForOf",W(1,se)))}function _e(a,o){if(a&1&&(n(0,"div",53),f(),n(1,"svg",54),S(2,"path",55),r(),E(),n(3,"p",56),s(4),r()()),a&2){let e=c(3);t(4),u(e.i18n.t("bmGrades.noProjects"))}}function he(a,o){if(a&1){let e=C();n(0,"div",59)(1,"div",60)(2,"div",61)(3,"h5",50),s(4),r(),n(5,"p",62),s(6),T(7,"date"),r()(),n(8,"div",63)(9,"span",64),s(10),r(),n(11,"button",65),y("click",function(){let i=p(e).$implicit,l=c(4);return g(l.deleteGrade(i.id))}),f(),n(12,"svg",48),S(13,"path",49),r()()()()()}if(a&2){let e=o.$implicit,d=c(4);t(4),u(e.name||d.i18n.t("bmGrades.unnamed")),t(2),u(k(7,5,e.date_taken,"dd.MM.yyyy")),t(3),w(d.getGradeColorClass(e.value)),t(),x(" ",e.value.toFixed(1)," ")}}function ve(a,o){if(a&1&&(n(0,"div",57),b(1,he,14,8,"div",58),r()),a&2){let e=c(3);t(),m("ngForOf",e.getIndividualGrades())}}function fe(a,o){if(a&1&&(n(0,"div",30)(1,"div",31)(2,"h4",50),s(3),r()(),n(4,"div",35),b(5,_e,5,1,"div",51)(6,ve,2,1,"div",52),r()()),a&2){let e=c(2);t(3),u(e.i18n.t("bmGrades.projects")),t(2),m("ngIf",e.getIndividualGrades().length===0),t(),m("ngIf",e.getIndividualGrades().length>0)}}function Se(a,o){if(a&1&&(n(0,"div",38),s(1),r()),a&2){let e=c(3);t(),x(" ",e.i18n.t("bmGrades.noExamGrade")," ")}}function ye(a,o){if(a&1){let e=C();n(0,"div",67)(1,"div",42)(2,"div",68),s(3),r(),n(4,"div",44),s(5),T(6,"date"),r()(),n(7,"div",45)(8,"span",46),s(9),r(),n(10,"button",47),y("click",function(){let i;p(e);let l=c(3);return g(l.deleteGrade((i=l.getExamGrade())==null?null:i.id))}),f(),n(11,"svg",48),S(12,"path",49),r()()()()}if(a&2){let e,d,i,l=c(3);t(3),u(l.i18n.t("bmGrades.finalExam")),t(2),x(" ",k(6,5,(e=l.getExamGrade())==null?null:e.date_taken,"dd.MM.yyyy")," "),t(3),w(l.getGradeColorClass(((d=l.getExamGrade())==null?null:d.value)||0)),t(),x(" ",(i=l.getExamGrade())==null||i.value==null?null:i.value.toFixed(1)," ")}}function Ce(a,o){if(a&1&&(n(0,"div",30)(1,"div",31)(2,"h4",50),s(3),r()(),n(4,"div",35),b(5,Se,2,1,"div",36)(6,ye,13,8,"div",66),r()()),a&2){let e=c(2);t(3),u(e.i18n.t("bmGrades.examGrade")),t(2),m("ngIf",!e.getExamGrade()),t(),m("ngIf",e.getExamGrade())}}function we(a,o){if(a&1&&(n(0,"div")(1,"div",13)(2,"h3",14),s(3),r(),b(4,le,8,2,"div",15),n(5,"div",16)(6,"div",17)(7,"div",18),s(8),r(),n(9,"div",19),s(10),r()(),b(11,ce,5,4,"div",20)(12,me,5,4,"div",20),r()(),b(13,be,2,2,"div",21)(14,fe,7,3,"div",12)(15,Ce,7,3,"div",12),r()),a&2){let e=c();t(3),u(e.i18n.t("bmGrades.gradeSummary")),t(),m("ngIf",e.isSpecialSubject()),t(3),w(e.getGradeColorClass(e.calculateFinalGrade())),t(),x(" ",e.calculateFinalGrade()>0?e.calculateFinalGrade().toFixed(1):"-"," "),t(2),u(e.i18n.t("bmGrades.finalGrade")),t(),m("ngIf",!e.isSpecialSubject()),t(),m("ngIf",(e.subject==null?null:e.subject.hasExam)&&!e.isSpecialSubject()),t(),m("ngIf",!e.isSpecialSubject()),t(),m("ngIf",e.isSpecialSubject()),t(),m("ngIf",(e.subject==null?null:e.subject.hasExam)&&!e.isSpecialSubject())}}function je(a,o){if(a&1&&(n(0,"option",86),s(1),r()),a&2){let e=c(2);t(),u(e.i18n.t("bmGrades.individualGrade"))}}function Ee(a,o){if(a&1&&(n(0,"option",87),s(1),r()),a&2){let e=c(2);t(),u(e.i18n.t("bmGrades.projectGrade"))}}function Ge(a,o){if(a&1&&(n(0,"option",88),s(1),r()),a&2){let e=c(2);t(),u(e.i18n.t("bmGrades.examGrade"))}}function Ie(a,o){if(a&1&&(n(0,"option",93),s(1),r()),a&2){let e=o.$implicit;m("value",e.id),t(),N(" ",e.name," (",(e.weight*100).toFixed(0),"% - ",e.semesters.join(", "),". Semester) ")}}function Me(a,o){if(a&1){let e=C();n(0,"div",95)(1,"label",96),s(2),r(),n(3,"select",97),v("ngModelChange",function(i){p(e);let l=c(3);return h(l.selectedPartTimeComponent,i)||(l.selectedPartTimeComponent=i),g(i)}),b(4,Ie,2,4,"option",98),r(),n(5,"p",99),s(6),r()()}if(a&2){let e=c(3);t(2),u(e.i18n.t("bmGrades.selectComponent")),t(),_("ngModel",e.selectedPartTimeComponent),t(),m("ngForOf",e.subject==null?null:e.subject.partTimeSubjects),t(2),u(e.i18n.t("bmGrades.componentNote"))}}function Te(a,o){if(a&1){let e=C();n(0,"div",57)(1,"div",89),s(2),r(),b(3,Me,7,4,"div",90),n(4,"div")(5,"label",75),s(6),r(),n(7,"input",91),v("ngModelChange",function(i){p(e);let l=c(2);return h(l.gradeName,i)||(l.gradeName=i),g(i)}),r()(),n(8,"div",80)(9,"div")(10,"label",75),s(11),r(),n(12,"select",92),v("ngModelChange",function(i){p(e);let l=c(2);return h(l.semester,i)||(l.semester=i),g(i)}),n(13,"option",93),s(14),r(),n(15,"option",93),s(16),r(),n(17,"option",93),s(18),r(),n(19,"option",93),s(20),r()()(),n(21,"div")(22,"label",75),s(23),r(),n(24,"input",94),v("ngModelChange",function(i){p(e);let l=c(2);return h(l.gradeWeight,i)||(l.gradeWeight=i),g(i)}),r()()()()}if(a&2){let e=c(2);t(2),F(" Debug: studyMode=",e.studyMode,", isPartTimeSubject=",e.isPartTimeSubject(),", subject.id=",e.subject==null?null:e.subject.id,", partTimeSubjects=",(e.subject==null||e.subject.partTimeSubjects==null?null:e.subject.partTimeSubjects.length)||0," "),t(),m("ngIf",e.studyMode==="parttime"&&e.isPartTimeSubject()),t(3),u(e.i18n.t("bmGrades.gradeName")),t(),m("placeholder",I(e.i18n.t("bmGrades.gradeNamePlaceholder"))),_("ngModel",e.gradeName),t(4),u(e.i18n.t("bmGrades.semester")),t(),_("ngModel",e.semester),t(),m("value",1),t(),x("1. ",e.i18n.t("bmGrades.semester")),t(),m("value",2),t(),x("2. ",e.i18n.t("bmGrades.semester")),t(),m("value",3),t(),x("3. ",e.i18n.t("bmGrades.semester")),t(),m("value",4),t(),x("4. ",e.i18n.t("bmGrades.semester")),t(3),u(e.i18n.t("bmGrades.weight")),t(),_("ngModel",e.gradeWeight)}}function ke(a,o){if(a&1){let e=C();n(0,"div",57)(1,"div")(2,"label",75),s(3),r(),n(4,"input",91),v("ngModelChange",function(i){p(e);let l=c(2);return h(l.gradeName,i)||(l.gradeName=i),g(i)}),r()(),n(5,"div")(6,"label",75),s(7),r(),n(8,"textarea",100),v("ngModelChange",function(i){p(e);let l=c(2);return h(l.projectDescription,i)||(l.projectDescription=i),g(i)}),r()(),n(9,"div")(10,"label",75),s(11),r(),n(12,"input",101),v("ngModelChange",function(i){p(e);let l=c(2);return h(l.projectDuration,i)||(l.projectDuration=i),g(i)}),r()()()}if(a&2){let e=c(2);t(3),u(e.i18n.t("bmGrades.projectName")),t(),m("placeholder",I(e.i18n.t("bmGrades.projectNamePlaceholder"))),_("ngModel",e.gradeName),t(3),u(e.i18n.t("bmGrades.projectDescription")),t(),m("placeholder",I(e.i18n.t("bmGrades.projectDescriptionPlaceholder"))),_("ngModel",e.projectDescription),t(3),u(e.i18n.t("bmGrades.projectDuration")),t(),m("placeholder",I(e.i18n.t("bmGrades.projectDurationPlaceholder"))),_("ngModel",e.projectDuration)}}function De(a,o){if(a&1){let e=C();n(0,"div",30)(1,"div",69)(2,"h3",70),s(3),r(),n(4,"button",71),y("click",function(){p(e);let i=c();return g(i.closeAddGrade())}),f(),n(5,"svg",72),S(6,"path",73),r()()(),E(),n(7,"div",35)(8,"form",74),y("ngSubmit",function(){p(e);let i=c();return g(i.addGrade())}),n(9,"div")(10,"label",75),s(11),r(),n(12,"select",76),v("ngModelChange",function(i){p(e);let l=c();return h(l.gradeType,i)||(l.gradeType=i),g(i)}),b(13,je,2,1,"option",77)(14,Ee,2,1,"option",78)(15,Ge,2,1,"option",79),r()(),b(16,Te,25,21,"div",52)(17,ke,13,12,"div",52),n(18,"div",80)(19,"div")(20,"label",75),s(21),r(),n(22,"input",81),v("ngModelChange",function(i){p(e);let l=c();return h(l.gradeValue,i)||(l.gradeValue=i),g(i)}),r()(),n(23,"div")(24,"label",75),s(25),r(),n(26,"input",82),v("ngModelChange",function(i){p(e);let l=c();return h(l.dateTaken,i)||(l.dateTaken=i),g(i)}),r()()(),n(27,"div",83)(28,"button",84),y("click",function(){p(e);let i=c();return g(i.closeAddGrade())}),s(29),r(),n(30,"button",85),s(31),r()()()()()}if(a&2){let e=c();t(3),u(e.i18n.t("bmGrades.addGrade")),t(8),u(e.i18n.t("bmGrades.gradeType")),t(),_("ngModel",e.gradeType),t(),m("ngIf",!e.isSpecialSubject()),t(),m("ngIf",e.isSpecialSubject()),t(),m("ngIf",(e.subject==null?null:e.subject.hasExam)&&!e.isSpecialSubject()),t(),m("ngIf",e.gradeType==="individual"),t(),m("ngIf",e.gradeType==="project"),t(4),u(e.i18n.t("bmGrades.gradeValue")),t(),_("ngModel",e.gradeValue),t(3),u(e.i18n.t("bmGrades.date")),t(),_("ngModel",e.dateTaken),t(3),x(" ",e.i18n.t("common.cancel")," "),t(),m("disabled",e.gradeType==="individual"&&!e.gradeName||!e.gradeValue),t(),x(" ",e.i18n.t("bmGrades.saveGrade")," ")}}var de=class a{constructor(o,e,d,i){this.supabaseService=o;this.i18n=e;this.route=d;this.router=i}subject;grades=[];back=new D;gradeAdded=new D;subjectId="";bmTypes=[];selectedBMType=null;isRouteMode=!1;studyMode="fulltime";currentView="overview";gradeType="individual";gradeValue=4;gradeName="";gradeWeight=1;semester=1;dateTaken="";projectDescription="";projectDuration="";selectedPartTimeComponent="";ngOnInit(){return j(this,null,function*(){this.dateTaken=new Date().toISOString().split("T")[0],this.route.params.subscribe(o=>{o.id&&(this.isRouteMode=!0,this.subjectId=o.id,this.loadSubjectData())})})}goBack(){this.isRouteMode?this.router.navigate(["/bm-grades"]):this.back.emit()}openAddGrade(){this.currentView="add-grade",this.resetForm()}closeAddGrade(){this.currentView="overview",this.resetForm()}resetForm(){this.gradeType=this.subject?.isSpecial?"project":"individual",this.gradeValue=4,this.gradeName="",this.gradeWeight=1,this.semester=1,this.dateTaken=new Date().toISOString().split("T")[0],this.projectDescription="",this.projectDuration="",this.selectedPartTimeComponent=this.getDefaultPartTimeComponent()}getDefaultPartTimeComponent(){return this.isPartTimeSubject()&&this.subject?.partTimeSubjects?.[0]?.id||""}isPartTimeSubject(){return this.subject?.partTimeSubjects&&this.subject.partTimeSubjects.length>0||!1}isSpecialSubject(){return this.subject?.isSpecial||!1}loadSubjectData(){return j(this,null,function*(){let o=this.supabaseService.getCurrentUser();if(!o){console.error("No user found in loadSubjectData");return}try{let{data:e,error:d}=yield this.supabaseService.client.from("bm_settings").select("*").eq("user_id",o.id).single();if(d){console.error("Error loading BM settings:",d);return}e&&(this.bmTypes=[{id:"tals",name:"BM 2 Technik, Architektur, Life Sciences (TALS)",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m-g",name:"Mathematik Grundlagen",shortName:"M-G",hasExam:!0,isCore:!0},{id:"m-s",name:"Mathematik Schwerpunkt",shortName:"M-S",hasExam:!0,isCore:!0},{id:"nw",name:"Naturwissenschaften",shortName:"NW",hasExam:!0,isCore:!0,partTimeSubjects:[{id:"nw-chemie",name:"Chemie",shortName:"CH",weight:.33,semesters:[1]},{id:"nw-physik",name:"Physik",shortName:"PH",weight:.67,semesters:[1,2]}]},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"wr",name:"Wirtschaft & Recht",shortName:"WR",hasExam:!0,isCore:!0},{id:"idpa",name:"Interdisziplin\xE4re Projektarbeit",shortName:"IDPA",hasExam:!1,isCore:!1,isSpecial:!0},{id:"idaf",name:"Interdisziplin\xE4re Arbeit in den F\xE4chern",shortName:"IDAF",hasExam:!1,isCore:!1,isSpecial:!0}]},{id:"wd-d",name:"BM 2 Dienstleistungen (WD-D)",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m",name:"Mathematik",shortName:"M",hasExam:!0,isCore:!0},{id:"fr",name:"Finanz- & Rechnungswesen",shortName:"FR",hasExam:!0,isCore:!0},{id:"wr",name:"Wirtschaft & Recht Schwerpunkt",shortName:"WR",hasExam:!0,isCore:!0},{id:"wr-e",name:"Wirtschaft & Recht Erg\xE4nzung",shortName:"WR-E",hasExam:!1,isCore:!1},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"idpa",name:"Interdisziplin\xE4re Projektarbeit",shortName:"IDPA",hasExam:!1,isCore:!1,isSpecial:!0},{id:"idaf",name:"Interdisziplin\xE4re Arbeit in den F\xE4chern",shortName:"IDAF",hasExam:!1,isCore:!1,isSpecial:!0}]},{id:"arte",name:"BM 2 Gestaltung & Kunst (ARTE)",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m",name:"Mathematik",shortName:"M",hasExam:!0,isCore:!0},{id:"gkk",name:"Gestaltung / Kunst / Kultur",shortName:"GKK",hasExam:!0,isCore:!0},{id:"ik",name:"Information & Kommunikation",shortName:"IK",hasExam:!0,isCore:!0},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"tu",name:"Technik & Umwelt",shortName:"TU",hasExam:!0,isCore:!0},{id:"idpa",name:"Interdisziplin\xE4re Projektarbeit",shortName:"IDPA",hasExam:!1,isCore:!1,isSpecial:!0},{id:"idaf",name:"Interdisziplin\xE4re Arbeit in den F\xE4chern",shortName:"IDAF",hasExam:!1,isCore:!1,isSpecial:!0}]},{id:"gesundheit",name:"BM 2 Gesundheit & Soziales",subjects:[{id:"d",name:"Deutsch",shortName:"D",hasExam:!0,isCore:!0},{id:"f",name:"Franz\xF6sisch",shortName:"F",hasExam:!0,isCore:!0},{id:"e",name:"Englisch",shortName:"E",hasExam:!0,isCore:!0},{id:"m",name:"Mathematik",shortName:"M",hasExam:!0,isCore:!0},{id:"sw",name:"Sozialwissenschaften",shortName:"SW",hasExam:!0,isCore:!0},{id:"nw",name:"Naturwissenschaften",shortName:"NW",hasExam:!0,isCore:!0},{id:"gp",name:"Geschichte & Politik",shortName:"GP",hasExam:!0,isCore:!0},{id:"wr",name:"Wirtschaft & Recht",shortName:"WR",hasExam:!0,isCore:!0},{id:"idpa",name:"Interdisziplin\xE4re Projektarbeit",shortName:"IDPA",hasExam:!1,isCore:!1,isSpecial:!0},{id:"idaf",name:"Interdisziplin\xE4re Arbeit in den F\xE4chern",shortName:"IDAF",hasExam:!1,isCore:!1,isSpecial:!0}]}],this.selectedBMType=this.bmTypes.find(i=>i.id===e.bm_type),this.studyMode=e.study_mode||"fulltime",this.selectedBMType&&(this.subject=this.selectedBMType.subjects.find(i=>i.id===this.subjectId))),yield this.loadGrades()}catch(e){console.error("Error loading subject data:",e)}})}loadGrades(){return j(this,null,function*(){let o=this.supabaseService.getCurrentUser();if(!(!o||!this.subject))try{let{data:e,error:d}=yield this.supabaseService.client.from("grades").select("*").eq("user_id",o.id).eq("subject_id",this.subject.id).order("created_at",{ascending:!1});e&&!d&&(this.grades=e.map(i=>({id:i.id,userId:i.user_id,subjectId:i.subject_id,type:i.type,value:i.value,semester:i.semester,name:i.name,weight:i.weight,date_taken:i.date_taken,createdAt:i.created_at})))}catch(e){console.error("Error loading grades:",e)}})}addGrade(){return j(this,null,function*(){let o=this.supabaseService.getCurrentUser();if(!o){console.error("No authenticated user found"),alert("Bitte melden Sie sich an, um Noten hinzuzuf\xFCgen.");return}try{if(!this.subject){console.error("No subject selected. subjectId:",this.subjectId,"selectedBMType:",this.selectedBMType),alert("Kein Fach ausgew\xE4hlt. Bitte laden Sie die Seite neu.");return}if(this.gradeValue<1||this.gradeValue>6){console.error("Invalid grade value:",this.gradeValue),alert("Grade value must be between 1.0 and 6.0");return}let e={user_id:o.id,subject_id:this.isPartTimeSubject()&&this.selectedPartTimeComponent?this.selectedPartTimeComponent:this.subject.id,type:this.gradeType,value:this.gradeValue,date_taken:this.dateTaken};this.gradeType==="individual"?(e.name=this.gradeName||"Unnamed Grade",e.weight=this.gradeWeight,e.semester=this.semester):this.gradeType==="project"&&(e.name=this.gradeName||"Projektarbeit",e.description=this.projectDescription,e.duration=this.projectDuration,e.type="individual"),console.log("Attempting to insert grade data:",e);let{data:d,error:i}=yield this.supabaseService.client.from("grades").insert(e).select();if(i){console.error("Supabase error details:",i),alert(`Error adding grade: ${i.message}`);return}console.log("Grade added successfully:",d),this.isRouteMode?yield this.loadGrades():this.gradeAdded.emit(),this.closeAddGrade()}catch(e){console.error("Error adding grade:",e),alert(`Unexpected error: ${e.message||"Unknown error occurred"}`)}})}deleteGrade(o){return j(this,null,function*(){if(confirm(this.i18n.t("bmGrades.confirmDelete")))try{let{error:e}=yield this.supabaseService.client.from("grades").delete().eq("id",o);e?(console.error("Error deleting grade:",e),alert(`Error deleting grade: ${e.message}`)):(this.grades=this.grades.filter(d=>d.id!==o),this.isRouteMode?console.log("Grade deleted successfully"):this.gradeAdded.emit())}catch(e){console.error("Error deleting grade:",e),alert(`Unexpected error: ${e.message||"Unknown error occurred"}`)}})}getIndividualGrades(){return this.grades.filter(o=>o.type==="individual")}getExamGrade(){return this.grades.find(o=>o.type==="exam")||null}getGradesByType(o){return this.grades.filter(e=>e.type===o)}getGradesBySemester(o){return this.grades.filter(e=>e.semester===o&&e.type==="individual")}calculateSemesterAverage(o){let e=this.getGradesBySemester(o);if(e.length===0)return 0;let d=e.reduce((l,M)=>l+(M.weight||1),0),i=e.reduce((l,M)=>l+M.value*(M.weight||1),0);return Math.round(i/d*2)/2}calculateExperienceGrade(){let o=[];for(let d=1;d<=4;d++){let i=this.calculateSemesterAverage(d);i>0&&o.push(i)}if(o.length===0)return 0;let e=o.reduce((d,i)=>d+i,0);return Math.round(e/o.length*2)/2}calculateFinalGrade(){let o=this.calculateExperienceGrade();if(!this.subject?.hasExam||!this.subject?.isCore)return o;let e=this.getExamGrade();return e?Math.round((o+e.value)/2*2)/2:o}getGradeColorClass(o){return o>=4?"text-green-600":"text-red-600"}getGradeBadgeClass(o){return o>=4?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static \u0275fac=function(e){return new(e||a)(G(q),G(ae),G(z),G(L))};static \u0275cmp=V({type:a,selectors:[["app-subject-detail"]],inputs:{subject:"subject",grades:"grades"},outputs:{back:"back",gradeAdded:"gradeAdded"},decls:16,vars:6,consts:[[3,"title","subtitle"],[1,"space-y-6"],[1,"bg-white","rounded-lg","shadow","p-4","sm:p-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-2","p-2","text-gray-600","hover:text-gray-800","rounded-md","hover:bg-gray-100",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"hidden","sm:inline"],[1,"px-3","sm:px-4","py-2","text-sm","font-medium","text-white","bg-blue-600","rounded-md","hover:bg-blue-700",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","sm:hidden"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],[4,"ngIf"],["class","bg-white rounded-lg shadow",4,"ngIf"],[1,"bg-white","rounded-lg","shadow","p-4","sm:p-6","mb-4","sm:mb-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],["class","mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-3","sm:gap-4"],[1,"text-center","p-3","sm:p-4","bg-gray-50","rounded-lg"],[1,"text-xl","sm:text-2xl","font-bold"],[1,"text-xs","sm:text-sm","text-gray-600"],["class","text-center p-3 sm:p-4 bg-gray-50 rounded-lg",4,"ngIf"],["class","grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",4,"ngIf"],[1,"mb-4","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","text-blue-800","font-medium"],[1,"text-xs","text-blue-700","mt-1"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4","sm:gap-6"],["class","bg-white rounded-lg shadow",4,"ngFor","ngForOf"],[1,"bg-white","rounded-lg","shadow"],[1,"px-4","sm:px-6","py-3","sm:py-4","border-b","border-gray-200"],[1,"flex","justify-between","items-center"],[1,"font-medium","text-gray-900","text-sm","sm:text-base"],[1,"text-xs","sm:text-sm","font-medium"],[1,"p-4","sm:p-6"],["class","text-center text-gray-500 py-4 text-sm",4,"ngIf"],["class","space-y-2 sm:space-y-3",4,"ngIf"],[1,"text-center","text-gray-500","py-4","text-sm"],[1,"space-y-2","sm:space-y-3"],["class","flex justify-between items-start sm:items-center p-3 bg-gray-50 rounded-lg",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","sm:items-center","p-3","bg-gray-50","rounded-lg"],[1,"flex-1","min-w-0"],[1,"font-medium","text-gray-900","text-sm","truncate"],[1,"text-xs","text-gray-500","mt-1"],[1,"flex","items-center","space-x-2","ml-2"],[1,"font-medium","text-sm"],[1,"text-red-400","hover:text-red-600","p-1","flex-shrink-0",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"font-medium","text-gray-900"],["class","text-center text-gray-500 py-8",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"text-center","text-gray-500","py-8"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","text-gray-300","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-sm"],[1,"space-y-4"],["class","border border-gray-200 rounded-lg p-4",4,"ngFor","ngForOf"],[1,"border","border-gray-200","rounded-lg","p-4"],[1,"flex","justify-between","items-start","mb-3"],[1,"flex-1"],[1,"text-sm","text-gray-600","mt-1"],[1,"flex","items-center","space-x-2"],[1,"text-xl","font-bold"],[1,"text-red-400","hover:text-red-600","p-1",3,"click"],["class","flex justify-between items-center p-3 bg-gray-50 rounded-lg",4,"ngIf"],[1,"flex","justify-between","items-center","p-3","bg-gray-50","rounded-lg"],[1,"font-medium","text-gray-900","text-sm"],[1,"px-4","sm:px-6","py-3","sm:py-4","border-b","border-gray-200","flex","justify-between","items-center"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"space-y-4","sm:space-y-6",3,"ngSubmit"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["name","gradeType","required","",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],["value","individual",4,"ngIf"],["value","project",4,"ngIf"],["value","exam",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["type","number","name","gradeValue","required","","min","1","max","6","step","0.1",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],["type","date","name","dateTaken","required","",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"flex","flex-col","sm:flex-row","justify-end","space-y-2","sm:space-y-0","sm:space-x-3","pt-4"],["type","button",1,"w-full","sm:w-auto","px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-100","rounded-md","hover:bg-gray-200",3,"click"],["type","submit",1,"w-full","sm:w-auto","px-4","py-2","text-sm","font-medium","text-white","bg-blue-600","rounded-md","hover:bg-blue-700","disabled:opacity-50",3,"disabled"],["value","individual"],["value","project"],["value","exam"],[1,"p-2","bg-gray-100","text-xs","text-gray-600","rounded"],["class","p-4 bg-blue-50 border border-blue-200 rounded-lg",4,"ngIf"],["type","text","name","gradeName","required","",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel","placeholder"],["name","semester",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],[3,"value"],["type","number","name","gradeWeight","required","","min","0.1","max","5","step","0.1",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"p-4","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"block","text-sm","font-medium","text-blue-800","mb-2"],["name","selectedPartTimeComponent","required","",1,"block","w-full","rounded-md","border-blue-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500","bg-white",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"text-xs","text-blue-600","mt-1"],["name","projectDescription","rows","3",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel","placeholder"],["type","text","name","projectDuration",1,"block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel","placeholder"]],template:function(e,d){e&1&&(n(0,"app-page-layout",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),y("click",function(){return d.goBack()}),f(),n(5,"svg",5),S(6,"path",6),r(),E(),n(7,"span",7),s(8),r()(),n(9,"button",8),y("click",function(){return d.openAddGrade()}),n(10,"span",7),s(11),r(),f(),n(12,"svg",9),S(13,"path",10),r()()()(),b(14,we,16,11,"div",11)(15,De,32,15,"div",12),r()()),e&2&&(m("title",(d.subject==null?null:d.subject.name)||"")("subtitle",(d.subject==null?null:d.subject.shortName)||""),t(8),u(d.i18n.t("common.back")),t(3),u(d.i18n.t("bmGrades.addGrade")),t(3),m("ngIf",d.currentView==="overview"),t(),m("ngIf",d.currentView==="add-grade"))},dependencies:[R,A,B,re,Q,$,ee,U,X,Z,H,K,ne,ie,te,J,Y,oe,O],styles:[".grade-card[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.grade-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.semester-section[_ngcontent-%COMP%]{border-left:4px solid #e5e7eb}.semester-section.has-grades[_ngcontent-%COMP%]{border-left-color:#3b82f6}.grade-item[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.grade-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.delete-button[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s ease-in-out}.grade-item[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{opacity:1}.grade-summary-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.grade-summary-card[_ngcontent-%COMP%]   .grade-value[_ngcontent-%COMP%]{text-shadow:0 2px 4px rgba(0,0,0,.1)}.form-section[_ngcontent-%COMP%]{background-color:#f8fafc;border-radius:8px;padding:1rem;margin-bottom:1rem}.form-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]})};export{de as SubjectDetailComponent};
